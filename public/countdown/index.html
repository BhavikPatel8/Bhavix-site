<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0f1a2f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>December 2026 Countdown</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>

/* ====================================
   FONT SIZE LOCK - INDUSTRIAL STANDARD
==================================== */

html{
    -webkit-text-size-adjust:100%;
    -moz-text-size-adjust:100%;
    -ms-text-size-adjust:100%;
    text-size-adjust:100%;
    font-size:16px !important;
}

/* ====================================
   MOBILE-FIRST NATIVE APP DESIGN
==================================== */

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    -webkit-user-select:none;
    user-select:none;
    -webkit-touch-callout:none;
    -webkit-tap-highlight-color:transparent;
    touch-action:pan-y;
}

html, body{
    width:100%;
    height:100%;
    overflow:hidden;
    position:fixed;
    overscroll-behavior:none;
}

body{
    font-family:'Poppins',sans-serif;
    background:#050b1e;
}

/* Scroll Container */
.scroll-container{
    width:100%;
    height:100%;
    overflow-x:hidden;
    overflow-y:auto;
    -webkit-overflow-scrolling:touch;
    overscroll-behavior:contain;
    scroll-behavior:auto;
}

/* ====================================
   LOADING SCREEN
==================================== */

.loading-screen{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:linear-gradient(to bottom, #050b1e 0%, #0f1a2f 50%, #1a2d4a 100%);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:9999;
    transition:opacity 0.5s ease, visibility 0.5s ease;
}

.loading-screen.hidden{
    opacity:0;
    visibility:hidden;
    pointer-events:none;
}

.loader{
    width:50px;
    height:50px;
    border:4px solid rgba(255,255,255,0.1);
    border-top:4px solid #667eea;
    border-radius:50%;
    animation:spin 1s linear infinite;
}

@keyframes spin{
    0%{ transform:rotate(0deg); }
    100%{ transform:rotate(360deg); }
}

.loading-text{
    margin-top:20px;
    color:#a8d8ff;
    font-size:0.9em;
    letter-spacing:1px;
}

/* ====================================
   BACKGROUND LAYERS
==================================== */

.background-layer{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index:0;
    pointer-events:none;
}

.bg-gradient{
    position:absolute;
    width:100%;
    height:100%;
    background:linear-gradient(to bottom, #050b1e 0%, #0f1a2f 50%, #1a2d4a 100%);
}

/* Animated Gradient Orbs */
.orb{
    position:absolute;
    border-radius:50%;
    filter:blur(80px);
    opacity:0.3;
    transition:all 0.8s ease;
}

.orb1{
    width:300px;
    height:300px;
    background:radial-gradient(circle, #667eea, transparent);
    top:-150px;
    left:-100px;
    animation:float1 20s ease-in-out infinite;
}

.orb2{
    width:250px;
    height:250px;
    background:radial-gradient(circle, #764ba2, transparent);
    top:30%;
    right:-80px;
    animation:float2 15s ease-in-out infinite;
}

.orb3{
    width:200px;
    height:200px;
    background:radial-gradient(circle, #f093fb, transparent);
    bottom:-50px;
    left:20%;
    animation:float3 18s ease-in-out infinite;
}

@keyframes float1{
    0%, 100%{ transform:translate(0, 0) scale(1); }
    33%{ transform:translate(50px, 100px) scale(1.2); }
    66%{ transform:translate(-30px, 50px) scale(0.9); }
}

@keyframes float2{
    0%, 100%{ transform:translate(0, 0) scale(1); }
    50%{ transform:translate(-60px, -80px) scale(1.3); }
}

@keyframes float3{
    0%, 100%{ transform:translate(0, 0) scale(1); }
    33%{ transform:translate(-40px, -60px) scale(1.1); }
    66%{ transform:translate(60px, 30px) scale(0.95); }
}

/* Music Active State */
body.music-active .orb1{
    animation:float1 8s ease-in-out infinite, pulse-orb 2s ease-in-out infinite;
    opacity:0.5;
}

body.music-active .orb2{
    animation:float2 6s ease-in-out infinite, pulse-orb 2.5s ease-in-out infinite;
    opacity:0.5;
}

body.music-active .orb3{
    animation:float3 7s ease-in-out infinite, pulse-orb 3s ease-in-out infinite;
    opacity:0.5;
}

@keyframes pulse-orb{
    0%, 100%{ transform:scale(1); filter:blur(80px); }
    50%{ transform:scale(1.2); filter:blur(100px); }
}

/* Particle System */
.particles{
    position:fixed;
    width:100%;
    height:100%;
    top:0;
    left:0;
    z-index:1;
    pointer-events:none;
    opacity:0.6;
}

.particle{
    position:absolute;
    width:3px;
    height:3px;
    background:#fff;
    border-radius:50%;
    animation:particle-float linear infinite;
}

@keyframes particle-float{
    0%{ transform:translateY(0) translateX(0); opacity:0; }
    10%{ opacity:1; }
    90%{ opacity:1; }
    100%{ transform:translateY(-100vh) translateX(50px); opacity:0; }
}

/* Stars */
.stars{
    position:fixed;
    width:100%;
    height:100%;
    top:0;
    left:0;
    z-index:1;
    pointer-events:none;
}

.star{
    position:absolute;
    width:2px;
    height:2px;
    background:white;
    border-radius:50%;
    opacity:0.7;
    animation:twinkle 3s infinite;
}

@keyframes twinkle{
    0%, 100%{ opacity:0.7; transform:scale(1); }
    50%{ opacity:0.2; transform:scale(0.8); }
}

/* Snowfall */
.snowflake{
    position:absolute;
    top:-20px;
    color:white;
    font-size:14px;
    opacity:0.8;
    animation:fall linear infinite;
    pointer-events:none;
}

@keyframes fall{
    to{ transform:translateY(110vh); }
}

/* ====================================
   APP CONTENT
==================================== */

.app-container{
    position:relative;
    z-index:5;
    width:100%;
    min-height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:15px;
    gap:15px;
    padding-top:max(env(safe-area-inset-top), 15px);
    padding-bottom:max(env(safe-area-inset-bottom), 20px);
}

/* Countdown Container */
.countdown-container{
    width:100%;
    max-width:420px;
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(20px);
    -webkit-backdrop-filter:blur(20px);
    padding:clamp(20px, 5vw, 28px);
    border-radius:24px;
    text-align:center;
    border:1px solid rgba(255,255,255,0.2);
    box-shadow:0 15px 40px rgba(0,0,0,0.5);
}

h1{
    font-size:clamp(1.4em, 5vw, 1.7em);
    font-weight:700;
    margin-bottom:8px;
    letter-spacing:1px;
    background:linear-gradient(135deg, #ffffff, #a8d8ff);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
}

.subtitle{
    font-size:clamp(0.8em, 3vw, 0.9em);
    color:#a8d8ff;
    margin-bottom:20px;
    font-weight:300;
}

.countdown-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
}

.time-unit{
    background:rgba(255,255,255,0.1);
    padding:clamp(12px, 3vw, 16px);
    border-radius:16px;
    border:1px solid rgba(255,255,255,0.15);
}

.time-unit:first-child{
    grid-column:span 2;
    padding:clamp(18px, 4vw, 22px);
}

.time-value{
    font-size:clamp(1.8em, 6vw, 2.1em);
    font-weight:700;
    background:linear-gradient(135deg, #ffffff, #e0e0e0);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
}

.time-unit:first-child .time-value{
    font-size:clamp(2.8em, 8vw, 3.4em);
    background:linear-gradient(135deg, #ffd700, #ffed4e);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
}

.time-label{
    margin-top:6px;
    font-size:clamp(0.65em, 2vw, 0.72em);
    letter-spacing:1.5px;
    color:#a8d8ff;
    text-transform:uppercase;
}

.milliseconds-section{
    margin-top:18px;
    background:rgba(255,255,255,0.08);
    padding:clamp(10px, 3vw, 14px);
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.12);
}

.milliseconds-value{
    font-size:clamp(1.3em, 4vw, 1.5em);
    font-weight:700;
    background:linear-gradient(135deg, #4dd0e1, #00bcd4);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
}

.milliseconds-label{
    font-size:clamp(0.6em, 2vw, 0.68em);
    letter-spacing:1.5px;
    color:#80deea;
    text-transform:uppercase;
}

/* ====================================
   MUSIC PLAYER
==================================== */

.music-player{
    width:100%;
    max-width:420px;
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(20px);
    -webkit-backdrop-filter:blur(20px);
    padding:clamp(20px, 5vw, 24px);
    border-radius:24px;
    border:1px solid rgba(255,255,255,0.2);
    box-shadow:0 15px 40px rgba(0,0,0,0.5);
    overflow:hidden;
    position:relative;
}

.music-player::before{
    content:'';
    position:absolute;
    top:-100%;
    left:-100%;
    width:300%;
    height:300%;
    background:radial-gradient(circle at center,
        rgba(102,126,234,0.3) 0%,
        rgba(118,75,162,0.2) 30%,
        transparent 70%);
    opacity:0;
    animation:rotate-glow 20s linear infinite;
    pointer-events:none;
    transition:opacity 0.5s ease;
}

.music-player.playing::before{
    opacity:1;
}

@keyframes rotate-glow{
    0%{ transform:rotate(0deg); }
    100%{ transform:rotate(360deg); }
}

.music-player.playing{
    border-color:rgba(102,126,234,0.5);
    animation:pulse-border 2s ease-in-out infinite;
}

@keyframes pulse-border{
    0%, 100%{
        box-shadow:0 15px 40px rgba(0,0,0,0.5),
                   0 0 40px rgba(102,126,234,0.3),
                   inset 0 0 30px rgba(102,126,234,0.1);
    }
    50%{
        box-shadow:0 15px 40px rgba(0,0,0,0.5),
                   0 0 60px rgba(102,126,234,0.5),
                   inset 0 0 40px rgba(102,126,234,0.2);
    }
}

/* Loading Indicator */
.music-loading{
    display:none;
    align-items:center;
    justify-content:center;
    gap:10px;
    margin-bottom:15px;
    padding:10px;
    background:rgba(255,255,255,0.05);
    border-radius:10px;
}

.music-loading.active{
    display:flex;
}

.music-loading-spinner{
    width:20px;
    height:20px;
    border:3px solid rgba(255,255,255,0.1);
    border-top:3px solid #667eea;
    border-radius:50%;
    animation:spin 0.8s linear infinite;
}

.music-loading-text{
    font-size:0.75em;
    color:#a8d8ff;
}

/* Special Mode */
.special-mode{
    background:linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
    padding:12px;
    border-radius:12px;
    margin-bottom:18px;
    border:1px solid rgba(255,215,0,0.4);
    font-size:clamp(0.75em, 2.5vw, 0.8em);
    color:#ffd700;
    text-shadow:0 0 10px rgba(255,215,0,0.3);
    animation:glow-alert 2s ease-in-out infinite;
}

@keyframes glow-alert{
    0%, 100%{ background:linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2)); }
    50%{ background:linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.3)); }
}

.music-header{
    margin-bottom:18px;
    position:relative;
    z-index:2;
}

.music-title{
    font-size:clamp(0.95em, 3.5vw, 1.05em);
    font-weight:600;
    color:#fff;
    margin-bottom:6px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    text-shadow:0 2px 10px rgba(0,0,0,0.3);
}

.music-subtitle{
    font-size:clamp(0.65em, 2.2vw, 0.72em);
    color:#a8d8ff;
    letter-spacing:0.8px;
    text-transform:uppercase;
}

.progress-container{
    width:100%;
    height:6px;
    background:rgba(255,255,255,0.15);
    border-radius:3px;
    margin-bottom:12px;
    position:relative;
    overflow:hidden;
    cursor:pointer;
    z-index:2;
}

.progress-bar{
    height:100%;
    background:linear-gradient(90deg, #667eea, #764ba2, #667eea);
    background-size:200% 100%;
    width:0%;
    border-radius:3px;
    box-shadow:0 0 15px rgba(102,126,234,0.6);
    transition:width 0.1s linear;
}

.music-player.playing .progress-bar{
    animation:shimmer 3s linear infinite;
}

@keyframes shimmer{
    0%{ background-position:200% 0; }
    100%{ background-position:-200% 0; }
}

.time-display{
    display:flex;
    justify-content:space-between;
    margin-bottom:20px;
    font-size:clamp(0.65em, 2.2vw, 0.72em);
    color:#a8d8ff;
    font-weight:500;
    z-index:2;
    position:relative;
}

.player-controls{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:18px;
    margin-bottom:20px;
    position:relative;
    z-index:2;
}

.control-btn{
    min-width:clamp(48px, 12vw, 52px);
    height:clamp(48px, 12vw, 52px);
    border-radius:50%;
    border:none;
    background:rgba(255,255,255,0.1);
    color:white;
    font-size:clamp(1em, 3vw, 1.1em);
    font-weight:600;
    cursor:pointer;
    display:flex;
    justify-content:center;
    align-items:center;
    transition:all 0.3s ease;
    border:1px solid rgba(255,255,255,0.2);
    padding:0 14px;
}

.control-btn:active{
    transform:scale(0.92);
}

.play-pause-btn{
    width:clamp(60px, 15vw, 64px);
    height:clamp(60px, 15vw, 64px);
    background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    box-shadow:0 8px 25px rgba(102,126,234,0.4);
    font-size:clamp(1.3em, 4vw, 1.4em);
    border:2px solid rgba(255,255,255,0.3);
}

.music-player.playing .play-pause-btn{
    animation:pulse-button 2s ease-in-out infinite;
}

@keyframes pulse-button{
    0%, 100%{
        box-shadow:0 8px 25px rgba(102,126,234,0.4);
        transform:scale(1);
    }
    50%{
        box-shadow:0 8px 35px rgba(102,126,234,0.6);
        transform:scale(1.05);
    }
}

.next-btn{
    background:rgba(255,255,255,0.12);
    border:1px solid rgba(255,255,255,0.25);
}

.status-indicator{
    display:flex;
    justify-content:center;
    gap:8px;
    position:relative;
    z-index:2;
}

.status-dot{
    width:9px;
    height:9px;
    border-radius:50%;
    background:rgba(255,255,255,0.2);
    transition:all 0.3s ease;
}

.status-dot.active{
    background:#00ff88;
    box-shadow:0 0 15px #00ff88, 0 0 25px #00ff88;
    animation:pulse-dot 1.2s ease-in-out infinite;
}

@keyframes pulse-dot{
    0%, 100%{
        opacity:1;
        transform:scale(1);
        box-shadow:0 0 15px #00ff88, 0 0 25px #00ff88;
    }
    50%{
        opacity:0.6;
        transform:scale(1.3);
        box-shadow:0 0 20px #00ff88, 0 0 35px #00ff88;
    }
}

/* Safe Area Support */
@supports(padding: max(0px)){
    .app-container{
        padding-left:max(15px, env(safe-area-inset-left));
        padding-right:max(15px, env(safe-area-inset-right));
        padding-top:max(15px, env(safe-area-inset-top));
        padding-bottom:max(20px, env(safe-area-inset-bottom));
    }
}

</style>
</head>

<body>

<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
    <div class="loader"></div>
    <div class="loading-text">Loading Music Player...</div>
</div>

<!-- Scroll Container -->
<div class="scroll-container">

<!-- Background Layers -->
<div class="background-layer">
    <div class="bg-gradient"></div>
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>
</div>

<!-- Particles -->
<div class="particles" id="particles"></div>

<!-- Stars -->
<div class="stars" id="stars"></div>

<!-- Snowfall -->
<div id="snowfall"></div>

<!-- App Container -->
<div class="app-container">

    <!-- Countdown Container -->
    <div class="countdown-container">
        <h1>❄️ December 2026 ❄️</h1>
        <div class="subtitle">Limited Time Left - Grow Yourself!</div>

        <div class="countdown-grid">
            <div class="time-unit">
                <div class="time-value" id="days">000</div>
                <div class="time-label">Days</div>
            </div>
            <div class="time-unit">
                <div class="time-value" id="months">00</div>
                <div class="time-label">Months</div>
            </div>
            <div class="time-unit">
                <div class="time-value" id="hours">00</div>
                <div class="time-label">Hours</div>
            </div>
            <div class="time-unit">
                <div class="time-value" id="minutes">00</div>
                <div class="time-label">Minutes</div>
            </div>
            <div class="time-unit">
                <div class="time-value" id="seconds">00</div>
                <div class="time-label">Seconds</div>
            </div>
        </div>

        <div class="milliseconds-section">
            <div class="milliseconds-value" id="msdot">00.000</div>
            <div class="milliseconds-label">Seconds.MS</div>
        </div>
    </div>

    <!-- Music Player -->
    <div class="music-player" id="musicPlayer">
        
        <!-- Loading Indicator -->
        <div class="music-loading" id="musicLoading">
            <div class="music-loading-spinner"></div>
            <div class="music-loading-text">Loading Track...</div>
        </div>

        <div class="special-mode" id="specialMode" style="display:none;">
            Final Countdown - Last 3 Days Special Theme Active
        </div>

        <div class="music-header">
            <div class="music-title" id="musicTitle">WinterLand(FF)_Theme</div>
            <div class="music-subtitle" id="musicSubtitle">Track 1 of 22</div>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
        </div>

        <div class="player-controls">
            <button class="control-btn play-pause-btn" id="playPauseBtn">▶</button>
            <button class="control-btn next-btn" id="nextBtn">Next</button>
        </div>

        <div class="status-indicator">
            <div class="status-dot" id="dot1"></div>
            <div class="status-dot" id="dot2"></div>
            <div class="status-dot" id="dot3"></div>
        </div>
    </div>

</div>

</div>

<!-- Audio Element -->
<audio id="audio" preload="metadata"></audio>

<script>

// ====================================
// STATE VARIABLES
// ====================================
let currentIndex = 0;
let isPlaying = false;
let isSpecialMode = false;
let isLoading = false;

// ====================================
// PARTICLES
// ====================================
const particlesContainer = document.getElementById("particles");
for(let i = 0; i < 30; i++){
    const particle = document.createElement("div");
    particle.className = "particle";
    particle.style.left = Math.random() * 100 + "%";
    particle.style.animationDuration = (Math.random() * 10 + 15) + "s";
    particle.style.animationDelay = Math.random() * 5 + "s";
    particlesContainer.appendChild(particle);
}

// ====================================
// STARS
// ====================================
const starsContainer = document.getElementById("stars");
for(let i = 0; i < 100; i++){
    const star = document.createElement("div");
    star.className = "star";
    star.style.left = Math.random() * 100 + "%";
    star.style.top = Math.random() * 100 + "%";
    star.style.opacity = Math.random();
    star.style.animationDelay = Math.random() * 3 + "s";
    starsContainer.appendChild(star);
}

// ====================================
// SNOWFALL
// ====================================
function createSnow(){
    const snow = document.createElement("div");
    snow.className = "snowflake";
    snow.textContent = "❄";
    snow.style.left = Math.random() * 100 + "%";
    snow.style.fontSize = (Math.random() * 6 + 10) + "px";
    snow.style.animationDuration = (Math.random() * 6 + 10) + "s";
    document.getElementById("snowfall").appendChild(snow);
    setTimeout(() => snow.remove(), 14000);
}
setInterval(createSnow, 1200);

// ====================================
// COUNTDOWN
// ====================================
function updateCountdown(){
    const now = new Date();
    const target = new Date("2026-12-01T00:00:00");
    const diff = target - now;

    if(diff <= 0){
        document.getElementById("days").textContent = "000";
        document.getElementById("months").textContent = "00";
        document.getElementById("hours").textContent = "00";
        document.getElementById("minutes").textContent = "00";
        document.getElementById("seconds").textContent = "00";
        document.getElementById("msdot").textContent = "00.000";
        return;
    }

    const totalDays = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
    const ms = diff % 1000;
    const months = Math.max(0,
        (target.getFullYear() - now.getFullYear()) * 12
        + (target.getMonth() - now.getMonth())
    );

    document.getElementById("days").textContent = String(totalDays).padStart(3, "0");
    document.getElementById("months").textContent = String(months).padStart(2, "0");
    document.getElementById("hours").textContent = String(hours).padStart(2, "0");
    document.getElementById("minutes").textContent = String(minutes).padStart(2, "0");
    document.getElementById("seconds").textContent = String(seconds).padStart(2, "0");
    document.getElementById("msdot").textContent =
        String(seconds).padStart(2, "0") + "." + String(ms).padStart(3, "0");

    checkSpecialMode(totalDays);
}

setInterval(updateCountdown, 50);
updateCountdown();

// ====================================
// MUSIC LIBRARY
// ====================================
const musicLibrary = [
    "1. WinterLand(FF)_Theme.mp3",
    "2. Pubg_Theme.mp3",
    "3. TheWolfAndTheMoon_Theme.mp3",
    "4. LavidadeRaquel_Theme.mp3",
    "5. RaquelySergioJuntos_Theme.mp3",
    "6. Everdream_Theme.mp3",
    "7. Game of Thrones_Theme.mp3",
    "8. BaahuBaliOST_Theme.mp3",
    "9. Shivam(BahuBali2)_Theme.mp3",
    "10. MotherPromise(KGF)_Theme.mp3",
    "11. SoundofSalaar_Theme.mp3",
    "12. CallOfSilence_Theme.mp3",
    "13. Shogeki(Shock)_Theme.mp3",
    "14. HiroyukiSawano_Theme.mp3",
    "15. Without Love(VinlandSaga)_Theme.mp3",
    "16. River(VinlandSaga)_Theme.mp3",
    "17. ManoftheWorld(Naruto)_Theme.mp3",
    "18. Senya(Naruto)_Theme.mp3",
    "19. Kato(Naruto)_Theme.mp3",
    "20. SadnessandSorrow(Naruto)_Theme.mp3",
    "21. MyHeartWillGoOn(Titanic)_Theme.mp3",
    "22. ThemeOfRADHA.mp3"
];

// ====================================
// DOM REFERENCES
// ====================================
const audio = document.getElementById("audio");
const musicPlayer = document.getElementById("musicPlayer");
const playPauseBtn = document.getElementById("playPauseBtn");
const nextBtn = document.getElementById("nextBtn");
const musicTitle = document.getElementById("musicTitle");
const musicSubtitle = document.getElementById("musicSubtitle");
const progressBar = document.getElementById("progressBar");
const progressContainer = document.getElementById("progressContainer");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");
const specialModeEl = document.getElementById("specialMode");
const loadingScreen = document.getElementById("loadingScreen");
const musicLoading = document.getElementById("musicLoading");

// ====================================
// HELPERS
// ====================================
function getCleanName(filename){
    return filename.replace(/^\d+\.\s*/, '').replace(/\.mp3$/i, '');
}

function formatTime(secs){
    if(isNaN(secs) || secs === Infinity) return "0:00";
    const m = Math.floor(secs / 60);
    const s = Math.floor(secs % 60);
    return m + ":" + (s < 10 ? "0" : "") + s;
}

function showMusicLoading(){
    isLoading = true;
    musicLoading.classList.add("active");
}

function hideMusicLoading(){
    isLoading = false;
    musicLoading.classList.remove("active");
}

// ====================================
// LOAD TRACK
// ====================================
function loadTrack(index){
    showMusicLoading();
    const file = musicLibrary[index];
    audio.src = file;
    musicTitle.textContent = getCleanName(file);
    musicSubtitle.textContent = "Track " + (index + 1) + " of " + musicLibrary.length;
    currentIndex = index;
    progressBar.style.width = "0%";
    currentTimeEl.textContent = "0:00";
    durationEl.textContent = "0:00";
}

// ====================================
// PLAY / PAUSE
// ====================================
function setPlayingUI(playing){
    if(playing){
        playPauseBtn.innerHTML = "&#9646;&#9646;";
        musicPlayer.classList.add("playing");
        document.body.classList.add("music-active");
        startDots();
    } else {
        playPauseBtn.innerHTML = "&#9654;";
        musicPlayer.classList.remove("playing");
        document.body.classList.remove("music-active");
        stopDots();
    }
}

function togglePlayPause(){
    if(isPlaying){
        audio.pause();
        isPlaying = false;
        setPlayingUI(false);
    } else {
        showMusicLoading();
        audio.volume = 0.5;
        audio.play().then(() => {
            isPlaying = true;
            setPlayingUI(true);
            hideMusicLoading();
        }).catch(err => {
            hideMusicLoading();
            console.warn("Playback failed:", musicLibrary[currentIndex], err);
        });
    }
}

// ====================================
// NEXT TRACK
// ====================================
function nextTrack(){
    if(isSpecialMode){
        audio.currentTime = 0;
        if(isPlaying) audio.play();
        return;
    }
    const wasPlaying = isPlaying;
    if(isPlaying){
        audio.pause();
        isPlaying = false;
        setPlayingUI(false);
    }
    currentIndex = (currentIndex + 1) % musicLibrary.length;
    loadTrack(currentIndex);
    if(wasPlaying){
        setTimeout(togglePlayPause, 300);
    }
}

// ====================================
// STATUS DOTS
// ====================================
function startDots(){
    ["dot1","dot2","dot3"].forEach(id => document.getElementById(id).classList.add("active"));
}
function stopDots(){
    ["dot1","dot2","dot3"].forEach(id => document.getElementById(id).classList.remove("active"));
}

// ====================================
// SPECIAL MODE
// ====================================
function checkSpecialMode(daysLeft){
    if(daysLeft <= 3 && !isSpecialMode){
        isSpecialMode = true;
        specialModeEl.style.display = "block";
        const wasPlaying = isPlaying;
        if(isPlaying){ audio.pause(); isPlaying = false; setPlayingUI(false); }
        loadTrack(21);
        if(wasPlaying) setTimeout(togglePlayPause, 300);
    } else if(daysLeft > 3 && isSpecialMode){
        isSpecialMode = false;
        specialModeEl.style.display = "none";
    }
}

// ====================================
// AUDIO EVENTS
// ====================================
audio.addEventListener("loadstart", function(){
    showMusicLoading();
});

audio.addEventListener("canplay", function(){
    hideMusicLoading();
});

audio.addEventListener("timeupdate", function(){
    if(audio.duration){
        progressBar.style.width = (audio.currentTime / audio.duration * 100) + "%";
        currentTimeEl.textContent = formatTime(audio.currentTime);
    }
});

audio.addEventListener("loadedmetadata", function(){
    durationEl.textContent = formatTime(audio.duration);
    hideMusicLoading();
});

audio.addEventListener("ended", function(){
    audio.currentTime = 0;
    audio.play();
});

audio.addEventListener("error", function(){
    hideMusicLoading();
});

// ====================================
// PROGRESS BAR CLICK
// ====================================
progressContainer.addEventListener("click", function(e){
    if(audio.duration){
        const rect = progressContainer.getBoundingClientRect();
        audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
    }
});

// ====================================
// BUTTON EVENTS
// ====================================
playPauseBtn.addEventListener("click", togglePlayPause);
nextBtn.addEventListener("click", nextTrack);

// ====================================
// INIT
// ====================================
loadTrack(0);

// Hide loading screen after 1 second
setTimeout(() => {
    loadingScreen.classList.add("hidden");
}, 1000);

// ====================================
// DISABLE RIGHT-CLICK
// ====================================
document.addEventListener("contextmenu", e => e.preventDefault());

// ====================================
// PREVENT AUTO-SCROLL BUGS
// ====================================
document.addEventListener("touchmove", function(e){
    // Allow scrolling only in scroll container
}, { passive: true });

</script>

</body>
</html>
